services:
  stream-website:
    build: .
    environment:
      - WEBSITE_URL=${WEBSITE_URL:-https://yarpbot.com/#/status}
      - RTMP_URL=${RTMP_URL:-rtmp://rtmp-server:1935/live/stream}
      - RESOLUTION=${RESOLUTION:-720p}
      - FRAMERATE=${FRAMERATE:-60}
      - LOG_LEVEL=${LOG_LEVEL:-debug}
      - LOG_FORMAT=${LOG_FORMAT:-json}
      - PORT=${PORT:-8080}
      - TWITCH_CLIENT_ID=${TWITCH_CLIENT_ID}
      - TWITCH_CLIENT_SECRET=${TWITCH_CLIENT_SECRET}
      - TWITCH_CHANNEL=${TWITCH_CHANNEL}
      - STATUS_CRON_SCHEDULE=${STATUS_CRON_SCHEDULE}
    ports:
      - "${PORT:-8080}:${PORT:-8080}"
    depends_on:
      - "rtmp-server"

  # RTMP server for testing
  rtmp-server:
    image: tiangolo/nginx-rtmp
    ports:
      - "1935:1935"
